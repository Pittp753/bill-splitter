<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill Splitter</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î font ‡πÅ‡∏•‡∏∞ padding ‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
        @media (max-width: 576px) {
            .table th, .table td {
                font-size: 0.85rem;
                padding: 0.3rem;
            }

            .btn-sm {
                padding: 0.25rem 0.4rem;
                font-size: 0.75rem;
            }
        }

        .custom-ratio {
            max-width: 70px;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">üí∞ ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡πÄ‡∏á‡∏¥‡∏ô (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏à‡πà‡∏≤‡∏¢)</h4>
            </div>
            <div class="card-body">

                <div class="table-responsive" style="overflow-x:auto;">
                    <table class="table table-bordered table-sm" id="peopleTable" style="min-width:750px;">
                        <thead class="table-light">
                            <tr>
                                <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                                <th>‡∏à‡πà‡∏≤‡∏¢‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß (‡∏ö‡∏≤‡∏ó)</th>
                                <th>‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏à‡πà‡∏≤‡∏¢</th>
                                <th>‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</th>
                                <th width="80"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input class="form-control name" value="A"></td>
                                <td><input type="number" class="form-control paid" value="1490"></td>
                                <td>
                                    <select class="form-select ratioSelect">
                                        <option value="1" selected>‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏° (100%)</option>
                                        <option value="0.5">‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏∂‡πà‡∏á (50%)</option>
                                        <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
                                    </select>
                                    <input type="number" class="form-control custom-ratio d-none mt-1" value="100" min="0" max="1" step="1" title="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô 50 = 50%">
                                </td>
                                <td class="result"></td>
                                <td class="text-center"><button class="btn btn-danger btn-sm" onclick="removeRow(this)">‡∏•‡∏ö</button></td>
                            </tr>
                            <tr>
                                <td><input class="form-control name" value="B"></td>
                                <td><input type="number" class="form-control paid" value="200"></td>
                                <td>
                                    <select class="form-select ratioSelect">
                                        <option value="1" selected>‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏° (100%)</option>
                                        <option value="0.5">‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏∂‡πà‡∏á (50%)</option>
                                        <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
                                    </select>
                                    <input type="number" class="form-control custom-ratio d-none mt-1" value="100" min="0" max="1" step="1" title="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô 50 = 50%">
                                </td>
                                <td class="result"></td>
                                <td class="text-center"><button class="btn btn-danger btn-sm" onclick="removeRow(this)">‡∏•‡∏ö</button></td>
                            </tr>
                            <tr>
                                <td><input class="form-control name" value="C"></td>
                                <td><input type="number" class="form-control paid" value="0"></td>
                                <td>
                                    <select class="form-select ratioSelect">
                                        <option value="1" selected>‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏° (100%)</option>
                                        <option value="0.5">‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏∂‡πà‡∏á (50%)</option>
                                        <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
                                    </select>
                                    <input type="number" class="form-control custom-ratio d-none mt-1" value="100" min="0" max="1" step="1" title="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô 50 = 50%">
                                </td>
                                <td class="result"></td>
                                <td class="text-center"><button class="btn btn-danger btn-sm" onclick="removeRow(this)">‡∏•‡∏ö</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mb-3 d-flex flex-wrap gap-2">
                    <button class="btn btn-primary flex-fill flex-md-auto" onclick="addRow()">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô</button>
                    <button class="btn btn-success flex-fill flex-md-auto" onclick="calculate()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
                    <div class="form-check form-switch ms-auto">
                        <input class="form-check-input" type="checkbox" id="roundToggle" onchange="calculate()">
                        <label class="form-check-label" for="roundToggle">‡∏õ‡∏±‡∏î‡πÄ‡∏®‡∏©‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°</label>
                    </div>
                </div>

                <div class="row mb-2">
                    <div class="col-6 col-md-6">‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div class="col-6 col-md-6 text-end text-danger fw-bold" id="totalAmount">0</div>

                    <div class="col-6 col-md-6">‡∏ï‡∏Å‡∏Ñ‡∏ô‡∏•‡∏∞</div>
                    <div class="col-6 col-md-6 text-end text-danger fw-bold" id="totalAmountPerPerson">0</div>
                </div>

                <div class="row g-3 mt-3">
                    <div class="col-12 col-md-6">
                        <div class="card border-success h-100">
                            <div class="card-header bg-success text-white">‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡πÄ‡∏á‡∏¥‡∏ô‡∏Ñ‡∏∑‡∏ô</div>
                            <div class="card-body">
                                <ul class="list-group mb-2" id="refundList"></ul>
                                <div class="text-end fw-bold text-success">‡∏£‡∏ß‡∏°: <span id="refundTotal">0</span> ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="card border-danger h-100">
                            <div class="card-header bg-danger text-white">‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°</div>
                            <div class="card-body">
                                <ul class="list-group mb-2" id="payList"></ul>
                                <div class="text-end fw-bold text-danger">‡∏£‡∏ß‡∏°: <span id="payTotal">0</span> ‡∏ö‡∏≤‡∏ó</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert mt-3" id="balanceAlert"></div>

            </div>
        </div>
    </div>

    <script>
        function addRow() {
            let tbody = document.querySelector("#peopleTable tbody");
            let row = tbody.insertRow();
            row.innerHTML = `
            <td><input class="form-control name" placeholder="‡∏ä‡∏∑‡πà‡∏≠"></td>
            <td><input type="number" class="form-control paid" value="0"></td>
            <td>
                <select class="form-select ratioSelect">
                    <option value="1" selected>‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏ï‡πá‡∏° (100%)</option>
                    <option value="0.5">‡∏à‡πà‡∏≤‡∏¢‡∏Ñ‡∏£‡∏∂‡πà‡∏á (50%)</option>
                    <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á</option>
                </select>
                <input type="number" class="form-control custom-ratio d-none mt-1" value="100" min="0" max="1" step="1" title="‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á ‡πÄ‡∏ä‡πà‡∏ô 50 = 50%">
            </td>
            <td class="result"></td>
            <td class="text-center"><button class="btn btn-danger btn-sm" onclick="removeRow(this)">‡∏•‡∏ö</button></td>
        `;
            attachSelectListener(row);
            calculate();
        }

        function removeRow(btn) { btn.closest("tr").remove(); calculate(); }

        // ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ select -> custom input
        function attachSelectListener(row) {
            const select = row.querySelector(".ratioSelect");
            const customInput = row.querySelector(".custom-ratio");
            select.addEventListener("change", () => {
                if (select.value === "custom") {
                    customInput.classList.remove("d-none");
                } else {
                    customInput.classList.add("d-none");
                    customInput.value = select.value;
                }
                calculate();
            });
        }

        document.querySelectorAll("#peopleTable tbody tr").forEach(row => attachSelectListener(row));

        document.addEventListener("input", e => {
            if (e.target.classList.contains("paid") || e.target.classList.contains("custom-ratio")) calculate();
        });
        document.addEventListener("keydown", e => { if (e.key === "Enter") { e.preventDefault(); calculate(); } });

        function calculate() {
            let rows = document.querySelectorAll("#peopleTable tbody tr");
            let totalPaid = 0, totalRatio = 0, totalperson = 0;
            rows.forEach(r => {
                let paid = parseFloat(r.querySelector(".paid").value) || 0;
                let ratio = parseFloat(r.querySelector(".custom-ratio").value) / 100 || 1;
                totalPaid += paid;
                totalRatio += ratio;
                totalperson++;
            });

            let perUnit = totalRatio ? totalPaid / totalRatio : 0;
            document.getElementById("totalAmount").innerText = totalPaid.toFixed(2);
            document.getElementById("totalAmountPerPerson").innerText = perUnit.toFixed(2);

            let refundList = document.getElementById("refundList"), payList = document.getElementById("payList");
            refundList.innerHTML = ""; payList.innerHTML = "";
            let refundTotal = 0, payTotal = 0;
            let roundMode = document.getElementById("roundToggle").checked;

            rows.forEach(r => {
                let name = r.querySelector(".name").value || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠";
                let paid = parseFloat(r.querySelector(".paid").value) || 0;
                let ratio = parseFloat(r.querySelector(".custom-ratio").value) / 100 || 1;
                let rawDiff = paid - perUnit * ratio;
                let cell = r.querySelector(".result");
                if (rawDiff > 0) cell.innerHTML = `<span class="badge bg-success">‡∏£‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô ${rawDiff.toFixed(2)} ‡∏ø</span>`;
                else if (rawDiff < 0) cell.innerHTML = `<span class="badge bg-danger">‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏° ${Math.abs(rawDiff).toFixed(2)} ‡∏ø</span>`;
                else cell.innerHTML = `<span class="badge bg-secondary">‡∏û‡∏≠‡∏î‡∏µ</span>`;

                if (rawDiff > 0) {
                    refundTotal += rawDiff;
                    refundList.innerHTML += `<li class="list-group-item d-flex justify-content-between">${name} <span class="text-success">${rawDiff.toFixed(2)}</span></li>`;
                } else if (rawDiff < 0) {
                    let pay = roundMode ? Math.ceil(Math.abs(rawDiff)) : Math.abs(rawDiff);
                    payTotal += pay;
                    payList.innerHTML += `<li class="list-group-item d-flex justify-content-between">${name} <span class="text-danger">${pay.toFixed(2)}</span></li>`;
                }
            });

            document.getElementById("refundTotal").innerText = refundTotal.toFixed(2);
            document.getElementById("payTotal").innerText = payTotal.toFixed(2);

            let alert = document.getElementById("balanceAlert");
            if (Math.abs(refundTotal - payTotal) < 0.01) {
                alert.className = "alert alert-success mt-3";
                alert.innerHTML = `‚úÖ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏°‡∏î‡∏∏‡∏• (${refundTotal.toFixed(2)} ‡∏ö‡∏≤‡∏ó)`;
            } else {
                alert.className = "alert alert-warning mt-3";
                alert.innerHTML = `‚ö†Ô∏è ‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏°‡∏î‡∏∏‡∏• ‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô ${(refundTotal - payTotal).toFixed(2)} ‡∏ö‡∏≤‡∏ó`;
            }
        }

        calculate();
    </script>
</body>
</html>
