<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>หารค่าบิล</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

    <div class="container mt-4">

        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">💰 เคลียร์เงิน</h4>
            </div>
            <div class="card-body">

                <div class="table-responsive mb-3">
                    <table class="table table-bordered" id="peopleTable">
                        <thead class="table-light">
                            <tr>
                                <th>ชื่อ</th>
                                <th>จ่ายไปแล้ว (บาท)</th>
                                <th>ผลลัพธ์</th>
                                <th width="80"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input class="form-control name" value="A"></td>
                                <td><input type="number" class="form-control paid" value="2110"></td>
                                <td class="result"></td>
                                <td class="text-center"><button class="btn btn-danger btn-sm" onclick="removeRow(this)">ลบ</button></td>
                            </tr>
                            <tr>
                                <td><input class="form-control name" value="B"></td>
                                <td><input type="number" class="form-control paid" value="1280"></td>
                                <td class="result"></td>
                                <td class="text-center"><button class="btn btn-danger btn-sm" onclick="removeRow(this)">ลบ</button></td>
                            </tr>
                            <tr>
                                <td><input class="form-control name" value="C"></td>
                                <td><input type="number" class="form-control paid" value="0"></td>
                                <td class="result"></td>
                                <td class="text-center"><button class="btn btn-danger btn-sm" onclick="removeRow(this)">ลบ</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="mb-3 d-flex flex-wrap gap-2">
                    <button class="btn btn-primary flex-fill flex-md-auto" onclick="addRow()">+ เพิ่มคน</button>
                    <button class="btn btn-success flex-fill flex-md-auto" onclick="calculate()">คำนวณ</button>
                    <div class="form-check form-switch ms-auto">
                        <input class="form-check-input" type="checkbox" id="roundToggle" onchange="calculate()">
                        <label class="form-check-label" for="roundToggle">ปัดเศษสรุปการเคลียร์เงิน</label>
                    </div>
                </div>

                <div class="row mb-2">
                    <div class="col-6 col-md-6">เงินรวมทั้งหมด</div>
                    <div class="col-6 col-md-6 text-end text-danger fw-bold" id="totalAmount">0</div>
                </div>
                <div class="row mb-3">
                    <div class="col-6 col-md-6">ตกคนละ</div>
                    <div class="col-6 col-md-6 text-end text-primary fw-bold" id="perPerson">0</div>
                </div>

                <div class="row g-3 mt-3">
                    <div class="col-12 col-md-6">
                        <div class="card border-success h-100">
                            <div class="card-header bg-success text-white">คนที่ต้องได้เงินคืน</div>
                            <div class="card-body">
                                <ul class="list-group mb-2" id="refundList"></ul>
                                <div class="text-end fw-bold text-success">รวม: <span id="refundTotal">0</span> บาท</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-12 col-md-6">
                        <div class="card border-danger h-100">
                            <div class="card-header bg-danger text-white">คนที่ต้องจ่ายเพิ่ม</div>
                            <div class="card-body">
                                <ul class="list-group mb-2" id="payList"></ul>
                                <div class="text-end fw-bold text-danger">รวม: <span id="payTotal">0</span> บาท</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="alert mt-3" id="balanceAlert"></div>

            </div>
        </div>
    </div>

    <script>
function addRow() {
    let tbody = document.querySelector("#peopleTable tbody");
    let row = tbody.insertRow();
    row.innerHTML = `
        <td><input class="form-control name" placeholder="ชื่อ"></td>
        <td><input type="number" class="form-control paid" value="0"></td>
        <td class="result"></td>
        <td class="text-center"><button class="btn btn-danger btn-sm" onclick="removeRow(this)">ลบ</button></td>
    `;
}

function removeRow(btn) { btn.closest("tr").remove(); calculate(); }
document.addEventListener("input", e => { if(e.target.classList.contains("paid")) calculate(); });
document.addEventListener("keydown", e => { if(e.key==="Enter"){ e.preventDefault(); calculate(); } });

function calculate() {
    let rows = document.querySelectorAll("#peopleTable tbody tr");
    let total = 0; rows.forEach(r => total += parseFloat(r.querySelector(".paid").value)||0);
    let perPerson = rows.length? total/rows.length:0;

    document.getElementById("totalAmount").innerText = total.toFixed(2);
    document.getElementById("perPerson").innerText = perPerson.toFixed(2);

    let refundList=document.getElementById("refundList"), payList=document.getElementById("payList");
    refundList.innerHTML=""; payList.innerHTML="";
    let diffs = [];
    rows.forEach(r=>{
        let name=r.querySelector(".name").value||"ไม่ระบุชื่อ";
        let paid=parseFloat(r.querySelector(".paid").value)||0;
        let rawDiff=paid-perPerson;
        let cell=r.querySelector(".result");
        if(rawDiff>0) cell.innerHTML=`<span class="badge bg-success">รับคืน ${rawDiff.toFixed(2)} ฿</span>`;
        else if(rawDiff<0) cell.innerHTML=`<span class="badge bg-danger">จ่ายเพิ่ม ${Math.abs(rawDiff).toFixed(2)} ฿</span>`;
        else cell.innerHTML=`<span class="badge bg-secondary">พอดี</span>`;
        diffs.push({name, rawDiff});
    });

    let roundMode=document.getElementById("roundToggle").checked;
    let refundTotal=0, payTotal=0;
    diffs.forEach(d=>{
        let diff = roundMode? Math.ceil(Math.abs(d.rawDiff))*(d.rawDiff>0?1:-1) : d.rawDiff;
        if(diff>0){ refundTotal+=diff;
            refundList.innerHTML+=`<li class="list-group-item d-flex justify-content-between">${d.name}<span class="text-success">${roundMode?diff:diff.toFixed(2)}</span></li>`;}
        else if(diff<0){ let pay=Math.abs(diff); payTotal+=pay;
            payList.innerHTML+=`<li class="list-group-item d-flex justify-content-between">${d.name}<span class="text-danger">${roundMode?pay:pay.toFixed(2)}</span></li>`;}
    });

    document.getElementById("refundTotal").innerText = roundMode?refundTotal:refundTotal.toFixed(2);
    document.getElementById("payTotal").innerText = roundMode?payTotal:payTotal.toFixed(2);

    let alert=document.getElementById("balanceAlert");
    if(Math.abs(refundTotal-payTotal)<0.01){
        alert.className="alert alert-success mt-3";
        alert.innerHTML=roundMode?`✅ เงินสมดุล (ปัดเศษ) ${refundTotal} บาท`:`✅ เงินสมดุล (${refundTotal.toFixed(2)} บาท)`;
    }else{
        alert.className="alert alert-warning mt-3";
        alert.innerHTML=`⚠️ เงินไม่สมดุล ต่างกัน ${(refundTotal-payTotal).toFixed(2)} บาท`;
    }
}

calculate();
    </script>

</body>
</html>